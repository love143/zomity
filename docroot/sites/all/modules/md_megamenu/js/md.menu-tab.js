!function(t){var e=Drupal.menuLayout,n=Drupal.styleHtml,i=Drupal.menuItem,a={tabs:null,tab_counter:t("ul li.tab-item").length+1,dlg_itemsettings:null,init:function(){t(".md-tabs-head li").live({mouseenter:function(){t(this).find(".ui-icon-close").show()},mouseleave:function(){t(this).find(".ui-icon-close").hide()}}),t(".md-tabs-head span.ui-icon-close").live("click",function(){var e=this,n=t(this).prev("a").attr("href"),i=t("input.settings",t(n)).val();if(i=t.stringToObject(i),confirm("Are you sure to delete this tab?")){for(var l=t(n).find(".block-item"),s=0;s<l.length;s++){var d=l[s],u=t.unserialize(t(d).find("input[type=hidden]").val()).block_module;t("#"+u).append(d)}if(0==i.tab_id){var m=t("li",a.tabs).index(t(this).parent());a.tabs.tabs("remove",m)}else t.ajax({url:Drupal.settings.basePath+"?q=admin/structure/md-megamenu/delete-tab",type:"POST",data:{tab:i.tab_id,token_value:t("input#delete_tab_token").val()},dataType:"json",success:function(n){if("OK"==n.message){var i=t("li",a.tabs).index(t(e).parent());a.tabs.tabs("remove",i)}}})}}),a.dlg_itemsettings=t("#dlg-mnuitemsetting").dialog({resizable:!1,autoOpen:!1,draggable:!1,modal:!0,width:1e3,open:function(){var e=t(this).data("settings"),n=t.stringToObject(e);if(null!=n)a.setMenuFormVal(n);else{var i=t("form",a.dlg_itemsettings)[0];i.reset(),t(i).find("input[type=hidden]").each(function(){this.value=""}),t(i).find(".image-preview").empty()}t(".md-subtabs").tabs("select",0),t("#mnu_title",a.dlg_itemsettings).focus(),t("#title_enabled").trigger("change")},close:function(){t("form",a.dlg_itemsettings)[0].reset(),n.hide()}}),t("#add_tab").click(function(){return a.dlg_itemsettings.data("settings",null).data("id",null).dialog({title:"Add new menu item",buttons:{Add:function(){a.addTab(),t(this).dialog("close")},Cancel:function(){t(this).dialog("close")}}}).dialog("open"),!1}),t(".mnu-settings").live("click",function(){console.log("aaaaa");var e=t(this).parent().find("input.settings").val(),n=t(this).parent().parent().attr("id");return a.dlg_itemsettings.data("settings",e).data("id",n).dialog({title:"Menu item data",buttons:{Save:function(){if(t("#form-mnuitemsetting").valid()){var e=t(this).data("id"),n=a.getMenuFormVal();a.updateTabSetting(e,n),t(this).dialog("close")}},Cancel:function(){t(this).dialog("close")}}}).dialog("open"),t("#submnu_full_width").trigger("change"),!1}),t("#form-mnuitemsetting").validate(),t("#blocklist").tabs(),t("#mni-subtabs").tabs({select:function(){n.hide()}}),t(".md-listleft a").click(function(){t(this).parent().parent().find("a").removeClass("border-white"),t(this).parent().prev().find("a").addClass("border-white")}),t(".md-listleft li.ui-state-active").each(function(){t(this).prev().find("a").addClass("border-white")}),t("#md-subtabs .itemcol").click(function(){t("#md-subtabs .itemcol").removeClass("selected"),t(this).addClass("selected")}),t(".el-block").live({mouseenter:function(){t(this).addClass("el-hover")},mouseleave:function(){t(this).removeClass("el-hover")}}),dlg_mmsettings=t("#dlg-mmsetting").dialog({resizable:!1,autoOpen:!1,draggable:!1,modal:!0,width:680,buttons:{OK:function(){t(this).dialog("close")}},open:function(){jQuery(".ui-widget-overlay").bind("click",function(){dlg_mmsettings.dialog("close")})}}),t("#megamenu-setting").live("click",function(){return dlg_mmsettings.dialog("open"),!1}),t("#title_enabled").change(function(){t(this).is(":checked")?t("#mnu_title").attr("disabled",!1):t("#mnu_title").attr("disabled",!0)}),a.flyoutItem=t("#dlg-flyout-item").dialog({resizable:!1,autoOpen:!1,draggable:!1,modal:!0,width:600,buttons:{OK:function(){$item=t(this).data("item");var e=a.getFormVal(t("#dlg-flyout-item form"));title=void 0!==e.a_title?e.a_title:"",t(">dl >dt >a.sm2_title",$item).html(title),$item.children("input.setting").val(t.objectToString(e)),$item.hasClass("ei-processed")||$item.addClass("ei-processed"),t(this).dialog("close")},Cancel:function(){t(this).dialog("close")}},close:function(){$item=t(this).data("item"),null==$item||$item.hasClass("ei-processed")||$item.remove()}}),t("#md-tabs").find("div.tree > ul").megadrupalTreeMenu(),t("a.mnu-addnewlink").live("click",function(){newli=t(Drupal.flyMenuItem),$tree=t(this).parent().prev("div.tree"),t("> ul",$tree).append(newli).megadrupalTreeMenu(),newli.find("a.fly-item-edit").trigger("click")}),t("a.fly-item-edit").live("click",function(){item=t(this).parent().parent().parent();var e=t.stringToObject(item.find("input.setting").val());return t("#dlg-flyout-item").loadingDialog(),t("#dlg-flyout-item").dialog("open"),t.post(Drupal.settings.basePath+"?q=admin/structure/md-megamenu/essential-item",e,function(e){t("#dlg-flyout-item").html(e),a.flyoutItem.data("item",item).unLoadingDialog()}),!1}),t("a.fly-item-delete").live("click",function(){t(this).parent().parent().parent().remove()}),a.tabs=t("#md-tabs")},initTab:function(){a.tabs.tabs({cookie:{expires:1},tabTemplate:'<li class="tab-item clearfix"><a class="tab-link" href="#{href}"><span class="tab-text">#{label}</span></a> <span class="ui-icon ui-icon-close">Remove Tab</span></li>',add:function(e,n){t(n.panel).append('<div class="settings"><a href="#" class="mnu-settings">[settings]</a><input autocomplete="off" type="hidden" class="settings" /></div><div class="md-menudropdown clearfix"><div class="tree"></div><div class="dropdown-addnew"><a href="#" class="mnu-addnewlink">[add new link]</a></div></div><div class="md-menuwrap md-1col1 clearfix"></div>'),a.tabs.tabs("select",n.index)},remove:function(e,n){t(n.panel).find("div.md-bl").each(function(){var e=t.unserialize(t(this).find("input.setting").val());"block"==e.type.substr(0,5)&&t("#blocks").append(t(this))})}}),this.sortTab()},removeIcon:function(){t("#icon_url").val("").change()},sortTab:function(){a.tabs.find(".ui-tabs-nav").sortable({axis:"x",stop:function(){a.tabs.tabs("refresh")}})},addTab:function(){var e=t("#mnu_title").val()||"Tab "+a.tab_counter,n="tabs-"+a.tab_counter;a.tabs.tabs("add","#tabs-"+a.tab_counter,e),a.updateTabSetting(n,a.getMenuFormVal()),a.tab_counter++},getSelectedTabIndex:function(){return a.tabs.tabs("option","selected")},updateTabSetting:function(e,n){if(n.mnu_fly_type)t("#"+e).find("div.md-menuwrap").hide(),t('a[href$="#'+e+'"] .tab-text').html(n.title_enabled?n.mnu_title:""),$menuflyout=t("#"+e).find("div.md-menudropdown"),$tree=$menuflyout.show().find(".tree"),$tree.is(":empty")&&($tree.html("<ul></ul>"),t("> ul",$tree).megadrupalTreeMenu()),t("#"+e).find("input.settings").val(t.objectToString(n));else{t("#"+e).find("div.md-menudropdown").hide(),t("#"+e).find("div.md-menuwrap").show(),t('a[href$="#'+e+'"] .tab-text').html(n.title_enabled?n.mnu_title:"");var l=t('a[href$="#'+e+'"] img');t("#dmg-menuicon").is(":checked")&&n.icon_url&&""!=n.icon_url?l.length>0?l.attr("src",n.icon_url):t('a[href$="#'+e+'"]').prepend('<img width="16" height="16" src="'+n.icon_url+'">'):l.length&&l.remove(),t("#"+e).find("input.settings").val(t.objectToString(n));var s=t("#"+e).find(".md-menuwrap"),d=n.mnu_layout,u=s.find(".md-col");if(0==u.length)a.changeLayout(s,d);else{oldColContent=[],t.each(u,function(e,n){oldColContent.push(t(n).find(".inner").html())}),a.changeLayout(s,d);var m=s.find(".md-col");t.each(oldColContent,function(e,n){e<m.length?t(m[e]).find(".inner").html(n):t(m[m.length-1]).find(".inner").append(n)})}i.mdcolsort()}},changeLayout:function(t,e){t.removeClass("fluid_mmcontainer_12 fluid_mmcontainer_16").addClass("fluid_mmcontainer_"+e.numCol),t.html(a.getMenuTabHtml(e.setting,e.numCol))},getMenuTabHtml:function(e,n){var i="";if(e="string"==typeof e?t.stringToObject(e):e,e.length>0)for(var a=0;a<e.length;a++){var l=e[a];i+='<div class="md-row clearfix">';for(var s=0;s<l.cols.length;s++){var d=parseInt(l.cols[s].length*n/48);i+='<div class="md-col {grid}"><div class="inner ui-sortable"></div></div>'.replace("{grid}","mmg_"+d)}i+="</div>"}return i},getMenuFormVal:function(){var n=e.getLayoutConfig();return{mnu_fly_type:t('#dlg-mnuitemsetting input[name="mnu_type"]').is(":checked")?!1:!0,title_enabled:t('#dlg-mnuitemsetting input[name="title_enabled"]').is(":checked")?!0:!1,mnu_title:t('#dlg-mnuitemsetting input[name="mnu_title"]').val(),mnu_path:t('#dlg-mnuitemsetting input[name="mnu_path"]').val(),icon_url:t('#dlg-mnuitemsetting input[name="icon_url"]').val(),mnu_desc:t('#dlg-mnuitemsetting textarea[name="mnu_desc"]').val(),mnu_class:t('#dlg-mnuitemsetting input[name="mnu_class"]').val(),mnu_id:t("input[name=menu_id]").val(),tab_id:t("#mnu_tab_id").val(),mnu_layout:n}},setMenuFormVal:function(n){if(t("#dlg-mnuitemsetting input[name=mnu_type]").attr("checked",!n.mnu_fly_type),t("#dlg-mnuitemsetting input[name=mnu_title]").val(n.mnu_title),t('#dlg-mnuitemsetting input[name="mnu_path"]').val(n.mnu_path),t('#dlg-mnuitemsetting textarea[name="mnu_desc"] ').val(n.mnu_desc),t('#dlg-mnuitemsetting input[name="icon_url"]').val(n.icon_url),e.applyLayoutConfig(n.mnu_layout),t('#dlg-mnuitemsetting input[name="mnu_class"]').val(n.mnu_class),t('#dlg-mnuitemsetting input[name="dms-bgc"]').val(n.smn_bgc),t('#dlg-mnuitemsetting input[name="dms-bow"]').val(n.smn_bow),t('#dlg-mnuitemsetting select[name="dms-bos"]').val(n.smn_bos),t('#dlg-mnuitemsetting input[name="dms-boc"]').val(n.smn_boc),t("#mnu_tab_id").val(n.tab_id),null!=n.icon_url&&""!=n.icon_url){var i=n.icon_url.split("&")[1];i=i.split("=")[1];var a=t("<img/>").attr("src",i);t("#dlg-mnuitemsetting .image-preview").empty().append(a)}},getFormVal:function(e){var n={};return t("input, select, textarea",t(e)).each(function(){n[t(this).attr("name")]=t(this).val()}),n}};Drupal.menuTab=a}(jQuery);
