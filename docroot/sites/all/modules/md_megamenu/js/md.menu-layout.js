!function(e){var t=Drupal.styleHtml,l={init:function(){e(".el-block").live({mouseenter:function(){e(this).addClass("el-hover")},mouseleave:function(){e(this).removeClass("el-hover")}}),e('#mni-layout input[name="column_grid"]').change(function(){var t=e("#mni-layout input:radio:checked").val()||12,n=[];n.isFull=!0,n.subWidth="",l.applyNumCol(t,l.getConfigObject("[[24,24],[48]]"),n)}).change(),e("#itemcolumn div.item").click(function(){e("#el-gen").html(""),l.getLayoutHtml(l.getConfigObject(e(this).attr("value")))}),e("#el-gen").sortable({handle:"a.handle",revert:!1,placeholder:"ui-state-highlight",items:"div.el-row"}),e("#layout_newrow").click(function(){e("#mni-layout input:radio:checked").val();return l.getLayoutHtml(l.getConfigObject("[[48]]")),!1}),e("#layout_save").click(function(){var t=[];e("#el-gen .el-row").each(function(){var n=[];e(this).find(".el-block").each(function(){n.push(l.extractColNum(e(this)))}),t.push(n)}),alert(e.objectToString(t))}),e(".el-delete").live("click",function(){var t=e(this).parent(),n=l.extractColNum(t);if(n>0&&12>n){var i=t.next("div.el-block"),r=l.extractColNum(i);if(!l.updateColNum(i,r+n)){var o=t.prev("div.el-block"),a=l.extractColNum(o);l.updateColNum(o,a+n)}t.remove()}else e(this).parent().parent().remove();return!1}),t.appendTo(document.body).hide(),e("input.color-picker",t).ColorPicker({onSubmit:function(t,l,n,i){e(i).val(l),e(i).ColorPickerHide()},onBeforeShow:function(){current_obj=this,e(this).ColorPickerSetColor(this.value)},onChange:function(t,l){e(current_obj).val(l)}}).bind("keyup",function(){e(this).ColorPickerSetColor(this.value)}),e("a.btn_save",t).click(function(){var n=l.getStyleHtmlVal();return parent=t.data("item"),parent.children("input.setting").val(e.objectToString(n)),t.hide(),!1}),e("a.btn_cancel",t).click(function(){return t.hide(),!1}),e(".el-style, .el-globalstyle").live("click",function(){var n=e(this).offset(),i=e(this).parent(),r=i.children("input.setting").val();return l.setStyleHtmlVal(e.stringToObject(r)),t.data("item",i).css({top:n.top+19,left:n.left-13}).show(),!1}),e(".el-split").live("click",function(){var t=e(this).parent(),n=(t.parent(),l.extractColNum(t));if(n>1){var i=Math.floor(n/2),r=n-i;l.updateColNum(t,r),t.after(l.getColTemplate(i))}return!1}),e(".el-wider").live("click",function(){var t=e(this).parent(),n=t.next("div.el-block");if(l.shortenCol(n,"next")){var i=l.extractColNum(t);l.updateColNum(t,++i)}return!1}),e(".el-shorten").live("click",function(){var t=e(this).parent(),n=t.prev("div.el-block");if(l.shortenCol(n,"prev")){var i=l.extractColNum(t);l.updateColNum(t,++i)}return!1})},getLayoutConfig:function(){var t=[],n=l.extractColNum(e("#el-gen")),i=l.extractFullWidth();return e("#el-gen .el-row").each(function(){var i=[];e(this).find(".el-block").each(function(){i.push({style:e.stringToObject(e(this).children("input.setting").val()),length:48*l.extractColNum(e(this))/n})}),t.push({style:e.stringToObject(e(this).children("input.setting").val()),cols:i})}),{numCol:n,setting:t,isFullWidth:i.isFull,subWidth:i.subWidth}},applyLayoutConfig:function(e){var t=[];t.isFull=e.isFullWidth,t.subWidth=e.subWidth,l.applyNumCol(e.numCol,e.setting,t)},shortenCol:function(e,t){if(null!=e&&e.length>0){var n=l.extractColNum(e);return n>1?(l.updateColNum(e,--n),!0):"next"==t?l.shortenCol(e.next("div.el-block"),t):l.shortenCol(e.prev("div.el-block"),t)}return!1},updateColNum:function(e,t){return t>0&&13>t&&null!=e&&e.length>0?(e.removeClass("mmg_1 mmg_2 mmg_3 mmg_4 mmg_5 mmg_6 mmg_7 mmg_8 mmg_9 mmg_10 mmg_11 mmg_12 mmg_13 mmg_14 mmg_15 mmg_16"),e.addClass("mmg_"+t),!0):!1},extractSpanNum:function(t){var l,n,i;for(l=e(t).attr("class"),n=l.split(/\s+/),i=0;i<n.length;i+=1)if(n[i].match(/^mmg_/))return n[i].split("_")[1]},extractColNum:function(e){var t;return null!=e&&e.length>0&&(t=e.attr("class").match(/\d+/)),t=t?parseInt(t[0]):0},extractFullWidth:function(){var t=[];return t.isFull=e("#submnu_full_width").is(":checked"),t.subWidth="",t.isFull||isNaN(parseInt(e("#mnu_subwid").val()))||(t.subWidth=e("#mnu_subwid").val()),t},getColTemplate:function(t,l){var n=e('<div class="el-block mmg_'+t+'"><a href="#" class="el-delete" title="Delete this column"></a><a href="#" class="el-style" title="Change column style"></a><input type="hidden" class="setting" value="" autocomplete="off" /><a href="#" class="el-split" title="Split column"></a><a href="#" class="el-wider" title="Make this column wider"></a><a href="#" class="el-shorten" title="Make this column shorten"></a></div>');return n.children("input.setting").val(e.objectToString(l)),n.clone()},getLayoutHtml:function(t){var n=l.extractColNum(e("#el-gen"));if(t="string"==typeof t?e.stringToObject(t):t,t.length>0)for(var i=0;i<t.length;i++){var r=t[i];if(row=e('<div class="el-row"><a href="#" class="handle"></a><a href="#" class="el-globalstyle" title="Change row style"></a><input type="hidden" class="setting" value="" autocomplete="off" /></div>'),row.children("input.setting").val(e.objectToString(r.style)),cols=r.cols,void 0!=cols){for(var o=0,a=0;a<cols.length-1;a++){var u=parseInt(cols[a].length*n/48);o+=u,n>o&&row.append(l.getColTemplate(u,cols[a].style))}n>o&&row.append(l.getColTemplate(n-o,cols[cols.length-1].style))}e("#el-gen").append(row)}},applyNumCol:function(t,n,i){e('input:radio[name="column_grid"][value="'+t+'"]').attr("checked",!0),e("#submnu_full_width").attr("checked",i.isFull),e("#mnu_subwid").val(i.subWidth),e("#el-gen").removeClass("fluid_mmcontainer_12 fluid_mmcontainer_16").addClass("fluid_mmcontainer_"+t),e("#el-gen").html(""),l.getLayoutHtml(n)},setStyleHtmlVal:function(l){l=e.extend({elsmargin:!1,elsbackground:"",elsborderw:"",elsborders:"",elsborderc:""},l),e('input[name="els-margin"]',t).attr("checked",l.elsmargin),e('input[name="els-background"]').val(l.elsbackground),e('input[name="els-borderw"]').val(l.elsborderw),e('select[name="els-borders"]').val(l.elsborders),e('input[name="els-borderc"]').val(l.elsborderc)},getConfigObject:function(t){for(var l=[],n=e.stringToObject(t),i=0;i<n.length;i++){rowSetting={style:null,cols:[]};for(var r=0;r<n[i].length;r++)rowSetting.cols.push({style:null,length:n[i][r]});l.push(rowSetting)}return l},getStyleHtmlVal:function(){return{elsmargin:e('input[name="els-margin"]',t).is(":checked")?!0:!1,elsbackground:e('input[name="els-background"]').val(),elsborderw:e('input[name="els-borderw"]').val(),elsborders:e('select[name="els-borders"]').val(),elsborderc:e('input[name="els-borderc"]').val()}}};Drupal.menuLayout=l}(jQuery);
